<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Time-Series Analysis for Fisheries and Environmental Data</title>
  <meta name="description" content="These are the computer labs for Applied Fisheries and Environmental Science Time-Series Analysis">
  <meta name="generator" content="bookdown 0.3.18 and GitBook 2.6.7">

  <meta property="og:title" content="Time-Series Analysis for Fisheries and Environmental Data" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  <meta property="og:description" content="These are the computer labs for Applied Fisheries and Environmental Science Time-Series Analysis" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Time-Series Analysis for Fisheries and Environmental Data" />
  
  <meta name="twitter:description" content="These are the computer labs for Applied Fisheries and Environmental Science Time-Series Analysis" />
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="E. E. Holmes, M. D. Scheuerell, and E. J. Ward">


<meta name="date" content="2017-05-03">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="sec-ts-differencing-to-remove-a-trend-or-seasonal-effects.html">
<link rel="next" href="sec-ts-white-noise-wn.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">AFTS</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="chap-basicmat.html"><a href="chap-basicmat.html"><i class="fa fa-check"></i><b>1</b> Basic matrix math in R</a><ul>
<li class="chapter" data-level="1.1" data-path="sec-basicmat-create.html"><a href="sec-basicmat-create.html"><i class="fa fa-check"></i><b>1.1</b> Creating matrices in R</a></li>
<li class="chapter" data-level="1.2" data-path="sec-basicmat-multiply.html"><a href="sec-basicmat-multiply.html"><i class="fa fa-check"></i><b>1.2</b> Matrix multiplication, addition and transpose</a></li>
<li class="chapter" data-level="1.3" data-path="sec-basicmat-subset.html"><a href="sec-basicmat-subset.html"><i class="fa fa-check"></i><b>1.3</b> Subsetting a matrix</a></li>
<li class="chapter" data-level="1.4" data-path="sec-basicmat-replace.html"><a href="sec-basicmat-replace.html"><i class="fa fa-check"></i><b>1.4</b> Replacing elements in a matrix</a></li>
<li class="chapter" data-level="1.5" data-path="sec-basicmat-diagonal.html"><a href="sec-basicmat-diagonal.html"><i class="fa fa-check"></i><b>1.5</b> Diagonal matrices and identity matrices</a></li>
<li class="chapter" data-level="1.6" data-path="sec-basicmat-inverse.html"><a href="sec-basicmat-inverse.html"><i class="fa fa-check"></i><b>1.6</b> Taking the inverse of a square matrix</a></li>
<li class="chapter" data-level="1.7" data-path="sec-basicmat-problems.html"><a href="sec-basicmat-problems.html"><i class="fa fa-check"></i><b>1.7</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="chap-mlr.html"><a href="chap-mlr.html"><i class="fa fa-check"></i><b>2</b> Linear regression in matrix form</a><ul>
<li class="chapter" data-level="" data-path="chap-mlr.html"><a href="chap-mlr.html#data-and-packages"><i class="fa fa-check"></i>Data and packages</a></li>
<li class="chapter" data-level="2.1" data-path="sec-mlr-lr1.html"><a href="sec-mlr-lr1.html"><i class="fa fa-check"></i><b>2.1</b> A simple regression: one explanatory variable</a></li>
<li class="chapter" data-level="2.2" data-path="sec-mlr-form1.html"><a href="sec-mlr-form1.html"><i class="fa fa-check"></i><b>2.2</b> Matrix Form 1</a><ul>
<li class="chapter" data-level="2.2.1" data-path="sec-mlr-form1.html"><a href="sec-mlr-form1.html#sec-mlr-solveform1"><i class="fa fa-check"></i><b>2.2.1</b> Solving for the parameters</a></li>
<li class="chapter" data-level="2.2.2" data-path="sec-mlr-form1.html"><a href="sec-mlr-form1.html#sec-mlr-form1m"><i class="fa fa-check"></i><b>2.2.2</b> Form 1 with multiple explanatory variables</a></li>
<li class="chapter" data-level="2.2.3" data-path="sec-mlr-form1.html"><a href="sec-mlr-form1.html#sec-mlr-form1when"><i class="fa fa-check"></i><b>2.2.3</b> When does Form 1 arise?</a></li>
<li class="chapter" data-level="2.2.4" data-path="sec-mlr-form1.html"><a href="sec-mlr-form1.html#sec-mlr-form1b"><i class="fa fa-check"></i><b>2.2.4</b> Matrix Form 1b: The transpose of Form 1</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="sec-mlr-form2.html"><a href="sec-mlr-form2.html"><i class="fa fa-check"></i><b>2.3</b> Matrix Form 2</a><ul>
<li class="chapter" data-level="2.3.1" data-path="sec-mlr-form2.html"><a href="sec-mlr-form2.html#sec-mlr-form2m"><i class="fa fa-check"></i><b>2.3.1</b> Form 2 with multiple explanatory variables</a></li>
<li class="chapter" data-level="2.3.2" data-path="sec-mlr-form2.html"><a href="sec-mlr-form2.html#sec-mlr-form2when"><i class="fa fa-check"></i><b>2.3.2</b> When does Form 2 arise?</a></li>
<li class="chapter" data-level="2.3.3" data-path="sec-mlr-form2.html"><a href="sec-mlr-form2.html#sec-mlr-solveform2"><i class="fa fa-check"></i><b>2.3.3</b> Solving for the parameters for Form 2</a></li>
<li class="chapter" data-level="2.3.4" data-path="sec-mlr-form2.html"><a href="sec-mlr-form2.html#sec-mlr-solveform2code"><i class="fa fa-check"></i><b>2.3.4</b> Code to solve for parameters in Form 2</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="sec-mlr-intercepts.html"><a href="sec-mlr-intercepts.html"><i class="fa fa-check"></i><b>2.4</b> Groups of intercepts</a><ul>
<li class="chapter" data-level="2.4.1" data-path="sec-mlr-intercepts.html"><a href="sec-mlr-intercepts.html#sec-mlr-intercepts-form1"><i class="fa fa-check"></i><b>2.4.1</b> North/South intercepts in Form 1</a></li>
<li class="chapter" data-level="2.4.2" data-path="sec-mlr-intercepts.html"><a href="sec-mlr-intercepts.html#sec-mlr-intercepts-form2"><i class="fa fa-check"></i><b>2.4.2</b> North/South intercepts in Form 2</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="sec-mlr-betas.html"><a href="sec-mlr-betas.html"><i class="fa fa-check"></i><b>2.5</b> Groups of <span class="math inline">\(\beta\)</span>’s</a><ul>
<li class="chapter" data-level="2.5.1" data-path="sec-mlr-betas.html"><a href="sec-mlr-betas.html#sec-mlr-betas-form1"><i class="fa fa-check"></i><b>2.5.1</b> Owner <span class="math inline">\(\beta\)</span>’s in Form 1</a></li>
<li class="chapter" data-level="2.5.2" data-path="sec-mlr-betas.html"><a href="sec-mlr-betas.html#sec-mlr-betas-form2"><i class="fa fa-check"></i><b>2.5.2</b> Owner <span class="math inline">\(\beta\)</span>’s in Form 2</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="sec-mlr-season-factor.html"><a href="sec-mlr-season-factor.html"><i class="fa fa-check"></i><b>2.6</b> Seasonal effect as a factor</a><ul>
<li class="chapter" data-level="2.6.1" data-path="sec-mlr-season-factor.html"><a href="sec-mlr-season-factor.html#sec-mlr-season-form1"><i class="fa fa-check"></i><b>2.6.1</b> Seasonal intercepts written in Form 1</a></li>
<li class="chapter" data-level="2.6.2" data-path="sec-mlr-season-factor.html"><a href="sec-mlr-season-factor.html#seasonal-intercepts-written-in-form-2-sec-mlr-season-form2"><i class="fa fa-check"></i><b>2.6.2</b> Seasonal intercepts written in Form 2 {#sec-mlr-season-form2</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="sec-mlr-season-w-var.html"><a href="sec-mlr-season-w-var.html"><i class="fa fa-check"></i><b>2.7</b> Seasonal effect plus other explanatory variables*</a></li>
<li class="chapter" data-level="2.8" data-path="sec-mlr-confound.html"><a href="sec-mlr-confound.html"><i class="fa fa-check"></i><b>2.8</b> Models with confounded parameters*</a></li>
<li class="chapter" data-level="2.9" data-path="sec-mlr-problems.html"><a href="sec-mlr-problems.html"><i class="fa fa-check"></i><b>2.9</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="chap-ts.html"><a href="chap-ts.html"><i class="fa fa-check"></i><b>3</b> Basic time-series functions in R</a><ul>
<li class="chapter" data-level="" data-path="chap-ts.html"><a href="chap-ts.html#data-and-packages-1"><i class="fa fa-check"></i>Data and packages</a></li>
<li class="chapter" data-level="3.1" data-path="sec-ts-data.html"><a href="sec-ts-data.html"><i class="fa fa-check"></i><b>3.1</b> CO<span class="math inline">\(_2\)</span> and global temperature data set</a></li>
<li class="chapter" data-level="3.2" data-path="sec-ts-time-series-plots.html"><a href="sec-ts-time-series-plots.html"><i class="fa fa-check"></i><b>3.2</b> Time series plots</a><ul>
<li class="chapter" data-level="3.2.1" data-path="sec-ts-time-series-plots.html"><a href="sec-ts-time-series-plots.html#ts-objects-and-plot.ts"><i class="fa fa-check"></i><b>3.2.1</b> <strong>ts</strong> objects and <code id="sec-ts-textbfts-objects-and-verbplotts">plot.ts()</code></a></li>
<li class="chapter" data-level="3.2.2" data-path="sec-ts-time-series-plots.html"><a href="sec-ts-time-series-plots.html#sec-ts-combining-and-plotting-multiple-textbfts-objects"><i class="fa fa-check"></i><b>3.2.2</b> Combining and plotting multiple <strong>ts</strong> objects</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="sec-ts-decomposition-of-time-series.html"><a href="sec-ts-decomposition-of-time-series.html"><i class="fa fa-check"></i><b>3.3</b> Decomposition of time series</a><ul>
<li class="chapter" data-level="3.3.1" data-path="sec-ts-decomposition-of-time-series.html"><a href="sec-ts-decomposition-of-time-series.html#sec-ts-estimating-trends"><i class="fa fa-check"></i><b>3.3.1</b> Estimating trends</a></li>
<li class="chapter" data-level="3.3.2" data-path="sec-ts-decomposition-of-time-series.html"><a href="sec-ts-decomposition-of-time-series.html#sec-ts-estimating-seasonal-effects"><i class="fa fa-check"></i><b>3.3.2</b> Estimating seasonal effects</a></li>
<li class="chapter" data-level="3.3.3" data-path="sec-ts-decomposition-of-time-series.html"><a href="sec-ts-decomposition-of-time-series.html#sec-ts-completing-the-model"><i class="fa fa-check"></i><b>3.3.3</b> Completing the model</a></li>
<li class="chapter" data-level="3.3.4" data-path="sec-ts-decomposition-of-time-series.html"><a href="sec-ts-decomposition-of-time-series.html#sec-ts-using-verbdecompose-for-decomposition"><i class="fa fa-check"></i><b>3.3.4</b> Using <code>decompose()</code> for decomposition</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="sec-ts-differencing-to-remove-a-trend-or-seasonal-effects.html"><a href="sec-ts-differencing-to-remove-a-trend-or-seasonal-effects.html"><i class="fa fa-check"></i><b>3.4</b> Differencing to remove a trend or seasonal effects</a><ul>
<li class="chapter" data-level="3.4.1" data-path="sec-ts-differencing-to-remove-a-trend-or-seasonal-effects.html"><a href="sec-ts-differencing-to-remove-a-trend-or-seasonal-effects.html#sec-ts-using-the-verbdiff-function"><i class="fa fa-check"></i><b>3.4.1</b> Using the <code>diff()</code> function</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="sec-ts-correlation-within-and-among-time-series.html"><a href="sec-ts-correlation-within-and-among-time-series.html"><i class="fa fa-check"></i><b>3.5</b> Correlation within and among time series</a><ul>
<li class="chapter" data-level="3.5.1" data-path="sec-ts-correlation-within-and-among-time-series.html"><a href="sec-ts-correlation-within-and-among-time-series.html#sec-ts-autocorrelation-function-acf"><i class="fa fa-check"></i><b>3.5.1</b> Autocorrelation function (ACF)</a></li>
<li class="chapter" data-level="3.5.2" data-path="sec-ts-correlation-within-and-among-time-series.html"><a href="sec-ts-correlation-within-and-among-time-series.html#sec-ts-partial-autocorrelation-function-pacf"><i class="fa fa-check"></i><b>3.5.2</b> Partial autocorrelation function (PACF)</a></li>
<li class="chapter" data-level="3.5.3" data-path="sec-ts-correlation-within-and-among-time-series.html"><a href="sec-ts-correlation-within-and-among-time-series.html#sec-ts-cross-correlation-function-ccf"><i class="fa fa-check"></i><b>3.5.3</b> Cross-correlation function (CCF)</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="sec-ts-white-noise-wn.html"><a href="sec-ts-white-noise-wn.html"><i class="fa fa-check"></i><b>3.6</b> White noise (WN)</a><ul>
<li class="chapter" data-level="3.6.1" data-path="sec-ts-white-noise-wn.html"><a href="sec-ts-white-noise-wn.html#sec-ts-simulating-white-noise"><i class="fa fa-check"></i><b>3.6.1</b> Simulating white noise</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="sec-ts-random-walks-rw.html"><a href="sec-ts-random-walks-rw.html"><i class="fa fa-check"></i><b>3.7</b> Random walks (RW)</a><ul>
<li class="chapter" data-level="3.7.1" data-path="sec-ts-random-walks-rw.html"><a href="sec-ts-random-walks-rw.html#sec-ts-simulating-a-random-walk"><i class="fa fa-check"></i><b>3.7.1</b> Simulating a random walk</a></li>
<li class="chapter" data-level="3.7.2" data-path="sec-ts-random-walks-rw.html"><a href="sec-ts-random-walks-rw.html#sec-ts-alternative-formulation-of-a-random-walk"><i class="fa fa-check"></i><b>3.7.2</b> Alternative formulation of a random walk</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="sec-ts-autoregressive-ar-models.html"><a href="sec-ts-autoregressive-ar-models.html"><i class="fa fa-check"></i><b>3.8</b> Autoregressive (AR) models</a><ul>
<li class="chapter" data-level="3.8.1" data-path="sec-ts-autoregressive-ar-models.html"><a href="sec-ts-autoregressive-ar-models.html#sec-ts-simulating-an-arp-process"><i class="fa fa-check"></i><b>3.8.1</b> Simulating an AR(<span class="math inline">\(p\)</span>) process</a></li>
<li class="chapter" data-level="3.8.2" data-path="sec-ts-autoregressive-ar-models.html"><a href="sec-ts-autoregressive-ar-models.html#sec-ts-correlation-structure-of-arp-processes"><i class="fa fa-check"></i><b>3.8.2</b> Correlation structure of AR(<span class="math inline">\(p\)</span>) processes</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="sec-ts-moving-average-ma-models.html"><a href="sec-ts-moving-average-ma-models.html"><i class="fa fa-check"></i><b>3.9</b> Moving-average (MA) models</a><ul>
<li class="chapter" data-level="3.9.1" data-path="sec-ts-moving-average-ma-models.html"><a href="sec-ts-moving-average-ma-models.html#sec-ts-simulating-an-maq-process"><i class="fa fa-check"></i><b>3.9.1</b> Simulating an MA(<span class="math inline">\(q\)</span>) process</a></li>
<li class="chapter" data-level="3.9.2" data-path="sec-ts-moving-average-ma-models.html"><a href="sec-ts-moving-average-ma-models.html#sec-ts-correlation-structure-of-maq-processes"><i class="fa fa-check"></i><b>3.9.2</b> Correlation structure of MA(<span class="math inline">\(q\)</span>) processes</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="sec-ts-autoregressive-moving-average-arma-models.html"><a href="sec-ts-autoregressive-moving-average-arma-models.html"><i class="fa fa-check"></i><b>3.10</b> Autoregressive moving-average (ARMA) models</a><ul>
<li class="chapter" data-level="3.10.1" data-path="sec-ts-autoregressive-moving-average-arma-models.html"><a href="sec-ts-autoregressive-moving-average-arma-models.html#fitting-armapq-models-with-arima"><i class="fa fa-check"></i><b>3.10.1</b> Fitting ARMA(<span class="math inline">\(p,q\)</span>) models with <code id="sec-ts-fitting-armapq-models-with-verbarima">arima()</code></a></li>
<li class="chapter" data-level="3.10.2" data-path="sec-ts-autoregressive-moving-average-arma-models.html"><a href="sec-ts-autoregressive-moving-average-arma-models.html#sec-ts-searching-over-model-orders"><i class="fa fa-check"></i><b>3.10.2</b> Searching over model orders</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="sec-ts-problems.html"><a href="sec-ts-problems.html"><i class="fa fa-check"></i><b>3.11</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chap-univariate-state-space.html"><a href="chap-univariate-state-space.html"><i class="fa fa-check"></i><b>4</b> Univariate state-space models</a><ul>
<li class="chapter" data-level="" data-path="chap-univariate-state-space.html"><a href="chap-univariate-state-space.html#data-and-packages-2"><i class="fa fa-check"></i>Data and packages</a></li>
<li class="chapter" data-level="4.1" data-path="sec-uss-fitting-a-state-space-model-with-marss.html"><a href="sec-uss-fitting-a-state-space-model-with-marss.html"><i class="fa fa-check"></i><b>4.1</b> Fitting a state-space model with MARSS</a></li>
<li class="chapter" data-level="4.2" data-path="sec-uss-examples-using-the-nile-river-data.html"><a href="sec-uss-examples-using-the-nile-river-data.html"><i class="fa fa-check"></i><b>4.2</b> Examples using the Nile river data</a><ul>
<li class="chapter" data-level="4.2.1" data-path="sec-uss-examples-using-the-nile-river-data.html"><a href="sec-uss-examples-using-the-nile-river-data.html#sec-uss-flat-level-model"><i class="fa fa-check"></i><b>4.2.1</b> Flat level model</a></li>
<li class="chapter" data-level="4.2.2" data-path="sec-uss-examples-using-the-nile-river-data.html"><a href="sec-uss-examples-using-the-nile-river-data.html#sec-uss-linear-trend-in-flow-model"><i class="fa fa-check"></i><b>4.2.2</b> Linear trend in flow model</a></li>
<li class="chapter" data-level="4.2.3" data-path="sec-uss-examples-using-the-nile-river-data.html"><a href="sec-uss-examples-using-the-nile-river-data.html#sec-uss-stochastic-level-model"><i class="fa fa-check"></i><b>4.2.3</b> Stochastic level model</a></li>
<li class="chapter" data-level="4.2.4" data-path="sec-uss-examples-using-the-nile-river-data.html"><a href="sec-uss-examples-using-the-nile-river-data.html#sec-uss-stochastic-level-model-with-drift"><i class="fa fa-check"></i><b>4.2.4</b> Stochastic level model with drift</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="sec-uss-the-structts-function.html"><a href="sec-uss-the-structts-function.html"><i class="fa fa-check"></i><b>4.3</b> The StructTS function</a></li>
<li class="chapter" data-level="4.4" data-path="sec-uss-comparing-models-with-aic-and-model-weights.html"><a href="sec-uss-comparing-models-with-aic-and-model-weights.html"><i class="fa fa-check"></i><b>4.4</b> Comparing models with AIC and model weights</a></li>
<li class="chapter" data-level="4.5" data-path="sec-uss-basic-diagnostics.html"><a href="sec-uss-basic-diagnostics.html"><i class="fa fa-check"></i><b>4.5</b> Basic diagnostics</a></li>
<li class="chapter" data-level="4.6" data-path="sec-uss-fitting-a-univariate-ar-state-space-model-with-jags.html"><a href="sec-uss-fitting-a-univariate-ar-state-space-model-with-jags.html"><i class="fa fa-check"></i><b>4.6</b> Fitting a univariate AR-1 state-space model with JAGS*</a></li>
<li class="chapter" data-level="4.7" data-path="sec-uss-a-simple-random-walk-model-of-animal-movement.html"><a href="sec-uss-a-simple-random-walk-model-of-animal-movement.html"><i class="fa fa-check"></i><b>4.7</b> A simple random walk model of animal movement</a></li>
<li class="chapter" data-level="4.8" data-path="sec-uss-problems.html"><a href="sec-uss-problems.html"><i class="fa fa-check"></i><b>4.8</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="chap-mss.html"><a href="chap-mss.html"><i class="fa fa-check"></i><b>5</b> Multivariate state-space models without covariates</a><ul>
<li class="chapter" data-level="" data-path="chap-mss.html"><a href="chap-mss.html#data-and-packages-3"><i class="fa fa-check"></i>Data and packages</a></li>
<li class="chapter" data-level="5.1" data-path="sec-mss-overview.html"><a href="sec-mss-overview.html"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="sec-mss-west-coast-harbor-seals-counts.html"><a href="sec-mss-west-coast-harbor-seals-counts.html"><i class="fa fa-check"></i><b>5.2</b> West coast harbor seals counts</a><ul>
<li class="chapter" data-level="5.2.1" data-path="sec-mss-west-coast-harbor-seals-counts.html"><a href="sec-mss-west-coast-harbor-seals-counts.html#sec-mss-load-the-harbor-seal-data"><i class="fa fa-check"></i><b>5.2.1</b> Load the harbor seal data</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="sec-mss-a-single-well-mixed-population.html"><a href="sec-mss-a-single-well-mixed-population.html"><i class="fa fa-check"></i><b>5.3</b> A single well-mixed population</a><ul>
<li class="chapter" data-level="5.3.1" data-path="sec-mss-a-single-well-mixed-population.html"><a href="sec-mss-a-single-well-mixed-population.html#sec-mss-the-observation-process"><i class="fa fa-check"></i><b>5.3.1</b> The observation process</a></li>
<li class="chapter" data-level="5.3.2" data-path="sec-mss-a-single-well-mixed-population.html"><a href="sec-mss-a-single-well-mixed-population.html#sec-mss-fitting-the-model"><i class="fa fa-check"></i><b>5.3.2</b> Fitting the model</a></li>
<li class="chapter" data-level="5.3.3" data-path="sec-mss-a-single-well-mixed-population.html"><a href="sec-mss-a-single-well-mixed-population.html#sec-mss-model-residuals"><i class="fa fa-check"></i><b>5.3.3</b> Model residuals</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="sec-mss-segind.html"><a href="sec-mss-segind.html"><i class="fa fa-check"></i><b>5.4</b> Four subpopulations with temporally uncorrelated errors</a><ul>
<li class="chapter" data-level="5.4.1" data-path="sec-mss-a-single-well-mixed-population.html"><a href="sec-mss-a-single-well-mixed-population.html#sec-mss-the-observation-process"><i class="fa fa-check"></i><b>5.4.1</b> The observation process</a></li>
<li class="chapter" data-level="5.4.2" data-path="sec-mss-segind.html"><a href="sec-mss-segind.html#sec-mss-fitting-mod1"><i class="fa fa-check"></i><b>5.4.2</b> Fitting the model</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="sec-mss-four-subpopulations-with-temporally-correlated-errors.html"><a href="sec-mss-four-subpopulations-with-temporally-correlated-errors.html"><i class="fa fa-check"></i><b>5.5</b> Four subpopulations with temporally correlated errors</a><ul>
<li class="chapter" data-level="5.5.1" data-path="sec-mss-four-subpopulations-with-temporally-correlated-errors.html"><a href="sec-mss-four-subpopulations-with-temporally-correlated-errors.html#sec-mss-fitting-mod2"><i class="fa fa-check"></i><b>5.5.1</b> Fitting the model</a></li>
<li class="chapter" data-level="5.5.2" data-path="sec-mss-four-subpopulations-with-temporally-correlated-errors.html"><a href="sec-mss-four-subpopulations-with-temporally-correlated-errors.html#sec-mss-residuals-mod2"><i class="fa fa-check"></i><b>5.5.2</b> Model residuals</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="sec-mss-using-marss-models-to-study-spatial-structure.html"><a href="sec-mss-using-marss-models-to-study-spatial-structure.html"><i class="fa fa-check"></i><b>5.6</b> Using MARSS models to study spatial structure</a></li>
<li class="chapter" data-level="5.7" data-path="sec-mss-hypotheses-regarding-spatial-structure.html"><a href="sec-mss-hypotheses-regarding-spatial-structure.html"><i class="fa fa-check"></i><b>5.7</b> Hypotheses regarding spatial structure</a></li>
<li class="chapter" data-level="5.8" data-path="sec-mss-set-up-the-hypotheses-as-different-models.html"><a href="sec-mss-set-up-the-hypotheses-as-different-models.html"><i class="fa fa-check"></i><b>5.8</b> Set up the hypotheses as different models</a><ul>
<li class="chapter" data-level="5.8.1" data-path="sec-mss-set-up-the-hypotheses-as-different-models.html"><a href="sec-mss-set-up-the-hypotheses-as-different-models.html#sec-fit-models-hyp"><i class="fa fa-check"></i><b>5.8.1</b> Fit the models</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="sec-mss-multivariate-state-space-models-with-jags.html"><a href="sec-mss-multivariate-state-space-models-with-jags.html"><i class="fa fa-check"></i><b>5.9</b> Multivariate state-space models with JAGS</a></li>
<li class="chapter" data-level="5.10" data-path="sec-mss-writing-the-model-in-jags.html"><a href="sec-mss-writing-the-model-in-jags.html"><i class="fa fa-check"></i><b>5.10</b> Writing the model in JAGS</a></li>
<li class="chapter" data-level="5.11" data-path="sec-mss-plot-the-posteriors-for-the-estimated-states.html"><a href="sec-mss-plot-the-posteriors-for-the-estimated-states.html"><i class="fa fa-check"></i><b>5.11</b> Plot the posteriors for the estimated states</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chap-dlm-dynamic-linear-models.html"><a href="chap-dlm-dynamic-linear-models.html"><i class="fa fa-check"></i><b>6</b> Dynamic linear models</a><ul>
<li class="chapter" data-level="" data-path="chap-dlm-dynamic-linear-models.html"><a href="chap-dlm-dynamic-linear-models.html#data"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="6.1" data-path="sec-dlm-overview.html"><a href="sec-dlm-overview.html"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="sec-dlm-example-of-a-univariate-dlm.html"><a href="sec-dlm-example-of-a-univariate-dlm.html"><i class="fa fa-check"></i><b>6.2</b> Example of a univariate DLM</a></li>
<li class="chapter" data-level="6.3" data-path="sec-dlm-fitting-a-univariate-dlm-with-marss.html"><a href="sec-dlm-fitting-a-univariate-dlm-with-marss.html"><i class="fa fa-check"></i><b>6.3</b> Fitting a univariate DLM with MARSS</a></li>
<li class="chapter" data-level="6.4" data-path="sec-dlm-forecasting-with-a-univariate-dlm.html"><a href="sec-dlm-forecasting-with-a-univariate-dlm.html"><i class="fa fa-check"></i><b>6.4</b> Forecasting with a univariate DLM</a><ul>
<li class="chapter" data-level="6.4.1" data-path="sec-dlm-forecasting-with-a-univariate-dlm.html"><a href="sec-dlm-forecasting-with-a-univariate-dlm.html#sec-dlm-forecasting-a-univariate-dlm-with-marss"><i class="fa fa-check"></i><b>6.4.1</b> Forecasting a univariate DLM with MARSS</a></li>
<li class="chapter" data-level="6.4.2" data-path="sec-dlm-forecasting-with-a-univariate-dlm.html"><a href="sec-dlm-forecasting-with-a-univariate-dlm.html#sec-dlm-dlm-forecast-diagnostics"><i class="fa fa-check"></i><b>6.4.2</b> DLM forecast diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="sec-dlm-homework.html"><a href="sec-dlm-homework.html"><i class="fa fa-check"></i><b>6.5</b> Homework</a><ul>
<li class="chapter" data-level="6.5.1" data-path="sec-dlm-homework.html"><a href="sec-dlm-homework.html#sec-dlm-spawner-recruit-data"><i class="fa fa-check"></i><b>6.5.1</b> Spawner-recruit data</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="sec-dlm-problems.html"><a href="sec-dlm-problems.html"><i class="fa fa-check"></i><b>6.6</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sec-dfa.html"><a href="sec-dfa.html"><i class="fa fa-check"></i><b>7</b> Dynamic Factor Analysis</a><ul>
<li class="chapter" data-level="" data-path="sec-dfa.html"><a href="sec-dfa.html#data-and-packages-4"><i class="fa fa-check"></i>Data and packages</a></li>
<li class="chapter" data-level="7.1" data-path="sec-dfa-intro.html"><a href="sec-dfa-intro.html"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="sec-dfa-example1.html"><a href="sec-dfa-example1.html"><i class="fa fa-check"></i><b>7.2</b> Example of a DFA model</a></li>
<li class="chapter" data-level="7.3" data-path="sec-dfa-constraining-a-dfa-model.html"><a href="sec-dfa-constraining-a-dfa-model.html"><i class="fa fa-check"></i><b>7.3</b> Constraining a DFA model</a></li>
<li class="chapter" data-level="7.4" data-path="sec-dfa-different-error-structures.html"><a href="sec-dfa-different-error-structures.html"><i class="fa fa-check"></i><b>7.4</b> Different error structures</a></li>
<li class="chapter" data-level="7.5" data-path="sec-dfa-lake-wa-data.html"><a href="sec-dfa-lake-wa-data.html"><i class="fa fa-check"></i><b>7.5</b> Lake Washington phytoplankton data</a><ul>
<li class="chapter" data-level="7.5.1" data-path="sec-dfa-lake-wa-data.html"><a href="sec-dfa-lake-wa-data.html#sec-dfa-plot-lake-wa-data"><i class="fa fa-check"></i><b>7.5.1</b> Plots of the data</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="sec-dfa-fitting-dfa-models-with-marss.html"><a href="sec-dfa-fitting-dfa-models-with-marss.html"><i class="fa fa-check"></i><b>7.6</b> Fitting DFA models with the MARSS package</a><ul>
<li class="chapter" data-level="7.6.1" data-path="sec-dfa-fitting-dfa-models-with-marss.html"><a href="sec-dfa-fitting-dfa-models-with-marss.html#sec-dfa-process-model"><i class="fa fa-check"></i><b>7.6.1</b> The process model</a></li>
<li class="chapter" data-level="7.6.2" data-path="sec-dfa-fitting-dfa-models-with-marss.html"><a href="sec-dfa-fitting-dfa-models-with-marss.html#sec-dfa-observation-model"><i class="fa fa-check"></i><b>7.6.2</b> The observation model</a></li>
<li class="chapter" data-level="7.6.3" data-path="sec-dfa-fitting-dfa-models-with-marss.html"><a href="sec-dfa-fitting-dfa-models-with-marss.html#sec-dfa-fit-model-in-marss"><i class="fa fa-check"></i><b>7.6.3</b> Fit the model in MARSS</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="sec-dfa-interpreting-the-marss-output.html"><a href="sec-dfa-interpreting-the-marss-output.html"><i class="fa fa-check"></i><b>7.7</b> Interpreting the MARSS output</a></li>
<li class="chapter" data-level="7.8" data-path="sec-dfa-rotating-loadings.html"><a href="sec-dfa-rotating-loadings.html"><i class="fa fa-check"></i><b>7.8</b> Rotating trends and loadings</a></li>
<li class="chapter" data-level="7.9" data-path="sec-dfa-estimated-states.html"><a href="sec-dfa-estimated-states.html"><i class="fa fa-check"></i><b>7.9</b> Estimated states and loadings</a></li>
<li class="chapter" data-level="7.10" data-path="sec-dfa-plot-data.html"><a href="sec-dfa-plot-data.html"><i class="fa fa-check"></i><b>7.10</b> Plotting the data and model fits</a></li>
<li class="chapter" data-level="7.11" data-path="sec-dfa-covariates.html"><a href="sec-dfa-covariates.html"><i class="fa fa-check"></i><b>7.11</b> Covariates in DFA models</a></li>
<li class="chapter" data-level="7.12" data-path="sec-dfa-lakeWA.html"><a href="sec-dfa-lakeWA.html"><i class="fa fa-check"></i><b>7.12</b> Example from Lake Washington</a></li>
<li class="chapter" data-level="7.13" data-path="sec-dfa-problems.html"><a href="sec-dfa-problems.html"><i class="fa fa-check"></i><b>7.13</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="chap-jags.html"><a href="chap-jags.html"><i class="fa fa-check"></i><b>8</b> JAGS for Bayesian time-series analysis</a><ul>
<li class="chapter" data-level="8.1" data-path="sec-jags-dataset.html"><a href="sec-jags-dataset.html"><i class="fa fa-check"></i><b>8.1</b> The airquality dataset</a></li>
<li class="chapter" data-level="8.2" data-path="sec-jags-lr-no-covariates.html"><a href="sec-jags-lr-no-covariates.html"><i class="fa fa-check"></i><b>8.2</b> Linear regression with no covariates</a></li>
<li class="chapter" data-level="8.3" data-path="sec-jags-regression-with-corr-errors.html"><a href="sec-jags-regression-with-corr-errors.html"><i class="fa fa-check"></i><b>8.3</b> Regression with autocorrelated errors</a></li>
<li class="chapter" data-level="8.4" data-path="sec-jags-rw.html"><a href="sec-jags-rw.html"><i class="fa fa-check"></i><b>8.4</b> Random walk time series model</a></li>
<li class="chapter" data-level="8.5" data-path="sec-jags-ar1.html"><a href="sec-jags-ar1.html"><i class="fa fa-check"></i><b>8.5</b> Autoregressive AR(1) time series models</a></li>
<li class="chapter" data-level="8.6" data-path="sec-jags-uss.html"><a href="sec-jags-uss.html"><i class="fa fa-check"></i><b>8.6</b> Univariate state space model</a><ul>
<li class="chapter" data-level="8.6.1" data-path="sec-jags-uss.html"><a href="sec-jags-uss.html#sec-jags-covariates"><i class="fa fa-check"></i><b>8.6.1</b> Including covariates</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="sec-jags-forecast.html"><a href="sec-jags-forecast.html"><i class="fa fa-check"></i><b>8.7</b> Forecasting with JAGS models</a></li>
<li class="chapter" data-level="8.8" data-path="sec-jags-problems.html"><a href="sec-jags-problems.html"><i class="fa fa-check"></i><b>8.8</b> Problems</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="chap-stan.html"><a href="chap-stan.html"><i class="fa fa-check"></i><b>9</b> Stan for Bayesian time-series analysis</a><ul>
<li class="chapter" data-level="9.1" data-path="sec-stan-packages-data.html"><a href="sec-stan-packages-data.html"><i class="fa fa-check"></i><b>9.1</b> Stan packages and chapter data sets</a></li>
<li class="chapter" data-level="9.2" data-path="sec-stan-lr.html"><a href="sec-stan-lr.html"><i class="fa fa-check"></i><b>9.2</b> Linear regression</a><ul>
<li class="chapter" data-level="9.2.1" data-path="sec-stan-lr.html"><a href="sec-stan-lr.html#sec-stan-burn"><i class="fa fa-check"></i><b>9.2.1</b> Burn-in and thinning</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="sec-stan-lr-ar.html"><a href="sec-stan-lr-ar.html"><i class="fa fa-check"></i><b>9.3</b> Linear regression with correlated errors</a></li>
<li class="chapter" data-level="9.4" data-path="sec-stan-rw.html"><a href="sec-stan-rw.html"><i class="fa fa-check"></i><b>9.4</b> Random walk model</a></li>
<li class="chapter" data-level="9.5" data-path="sec-stan-ar1.html"><a href="sec-stan-ar1.html"><i class="fa fa-check"></i><b>9.5</b> Autoregressive models</a></li>
<li class="chapter" data-level="9.6" data-path="sec-stan-uss.html"><a href="sec-stan-uss.html"><i class="fa fa-check"></i><b>9.6</b> Univariate state-space models</a></li>
<li class="chapter" data-level="9.7" data-path="sec-stan-dfa.html"><a href="sec-stan-dfa.html"><i class="fa fa-check"></i><b>9.7</b> Dynamic factor analysis</a><ul>
<li class="chapter" data-level="9.7.1" data-path="sec-stan-dfa.html"><a href="sec-stan-dfa.html#sec-stan-loo"><i class="fa fa-check"></i><b>9.7.1</b> Using leave one out cross-validation to select models</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="sec-stan-state-uncertainty.html"><a href="sec-stan-state-uncertainty.html"><i class="fa fa-check"></i><b>9.8</b> Uncertainty intervals on states</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time-Series Analysis for Fisheries and Environmental Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sec-ts-correlation-within-and-among-time-series" class="section level2">
<h2><span class="header-section-number">3.5</span> Correlation within and among time series</h2>
<p>The concepts of covariance and correlation are very important in time series analysis. In particular, we can examine the correlation structure of the original data or random errors from a decomposition model to help us identify possible form(s) of (non)stationary model(s) for the stochastic process.</p>
<div id="sec-ts-autocorrelation-function-acf" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Autocorrelation function (ACF)</h3>
<p>Autocorrelation is the correlation of a variable with itself at differing time lags. Recall from lecture that we defined the sample autocovariance function (ACVF), <span class="math inline">\(c_k\)</span>, for some lag <span class="math inline">\(k\)</span> as</p>
<span class="math display" id="eq:ACVF">\[\begin{equation}
\tag{3.10}
c_k = \frac{1}{n}\sum_{t=1}^{n-k} \left(x_t-\bar{x}\right) \left(x_{t+k}-\bar{x}\right)
\end{equation}\]</span>
<p>Note that the sample autocovariance of <span class="math inline">\(\{x_t\}\)</span> at lag 0, <span class="math inline">\(c_0\)</span>, equals the sample variance of <span class="math inline">\(\{x_t\}\)</span> calculated with a denominator of <span class="math inline">\(n\)</span>. The sample autocorrelation function (ACF) is defined as</p>
<span class="math display" id="eq:ACF">\[\begin{equation}
\tag{3.11}
r_k = \frac{c_k}{c_0} = \text{Cor}(x_t,x_{t+k})
\end{equation}\]</span>
<p>Recall also that an approximate 95% confidence interval on the ACF can be estimated by</p>
<span class="math display" id="eq:ACF95CI">\[\begin{equation}
\tag{3.12}
-\frac{1}{n} \pm \frac{2}{\sqrt{n}}
\end{equation}\]</span>
<p>where <span class="math inline">\(n\)</span> is the number of data points used in the calculation of the ACF.</p>
<p>It is important to remember two things here. First, although the confidence interval is commonly plotted and interpreted as a horizontal line over all time lags, the interval itself actually grows as the lag increases because the number of data points <span class="math inline">\(n\)</span> used to estimate the correlation decreases by 1 for every integer increase in lag. Second, care must be exercised when interpreting the “significance” of the correlation at various lags because we should expect, <em>a priori</em>, that approximately 1 out of every 20 correlations will be significant based on chance alone.</p>
<p>We can use the <code>acf()</code> function in R to compute the sample ACF (note that adding the option <code>type=&quot;covariance&quot;</code> will return the sample auto-covariance (ACVF) instead of the ACF–type <code>?acf</code> for details). Calling the function by itself will will automatically produce a correlogram (<em>i.e.</em>, a plot of the autocorrelation versus time lag). The argument <code>lag.max</code> allows you to set the number of positive and negative lags. Let’s try it for the CO<span class="math inline">\(_2\)</span> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## correlogram of the CO2 data
<span class="kw">acf</span>(co2, <span class="dt">lag.max =</span> <span class="dv">36</span>)</code></pre></div>

<div class="figure"><span id="fig:ts-plotACFb"></span>
<img src="AFTS_files/figure-html/ts-plotACFb-1.png" alt="Correlogram of the observed atmospheric CO\(_2\) concentration at Mauna Loa, Hawai’i obtained with the function acf()." width="672" />
<p class="caption">
Figure 3.10: Correlogram of the observed atmospheric CO<span class="math inline">\(_2\)</span> concentration at Mauna Loa, Hawai’i obtained with the function <code>acf()</code>.
</p>
</div>
<p>There are 4 things about Figure <a href="sec-ts-correlation-within-and-among-time-series.html#fig:ts-plotACFb">3.10</a> that are noteworthy:</p>
<ol style="list-style-type: decimal">
<li>the ACF at lag 0, <span class="math inline">\(r_0\)</span>, equals 1 by default (<em>i.e.</em>, the correlation of a time series with itself)–it’s plotted as a reference point;</li>
<li>the <span class="math inline">\(x\)</span>-axis has decimal values for lags, which is caused by R using the year index as the lag rather than the month;</li>
<li>the horizontal blue lines are the approximate 95% CI’s; and</li>
<li><p>there is very high autocorrelation even out to lags of 36 months.</p>
<pre><code>                                                                       As an alternative to the default plots for **acf** objects, let&#39;s define a new plot function for **acf** objects with some better features:</code></pre></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## better ACF plot
plot.acf &lt;-<span class="st"> </span>function(ACFobj) {
    rr &lt;-<span class="st"> </span>ACFobj$acf[-<span class="dv">1</span>]
    kk &lt;-<span class="st"> </span><span class="kw">length</span>(rr)
    nn &lt;-<span class="st"> </span>ACFobj$n.used
    <span class="kw">plot</span>(<span class="kw">seq</span>(kk), rr, <span class="dt">type =</span> <span class="st">&quot;h&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">yaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="dt">xaxs =</span> <span class="st">&quot;i&quot;</span>, 
        <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">floor</span>(<span class="kw">min</span>(rr)), <span class="dv">1</span>), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, kk +<span class="st"> </span><span class="dv">1</span>), <span class="dt">xlab =</span> <span class="st">&quot;Lag&quot;</span>, 
        <span class="dt">ylab =</span> <span class="st">&quot;Correlation&quot;</span>, <span class="dt">las =</span> <span class="dv">1</span>)
    <span class="kw">abline</span>(<span class="dt">h =</span> -<span class="dv">1</span>/nn +<span class="st"> </span><span class="kw">c</span>(-<span class="dv">2</span>, <span class="dv">2</span>)/<span class="kw">sqrt</span>(nn), <span class="dt">lty =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)
    <span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>)
}</code></pre></div>
<p>Now we can assign the result of <code>acf()</code> to a variable and then use the information contained therein to plot the correlogram with our new plot function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## acf of the CO2 data
co2.acf &lt;-<span class="st"> </span><span class="kw">acf</span>(co2, <span class="dt">lag.max =</span> <span class="dv">36</span>)
## correlogram of the CO2 data
<span class="kw">plot.acf</span>(co2.acf)</code></pre></div>
<p><img src="AFTS_files/figure-html/ts-DoOurACF-1.png" width="672" /></p>

<div class="figure"><span id="fig:ts-plotbetterACF"></span>
<img src="AFTS_files/figure-html/ts-plotbetterACF-1.png" alt="Correlogram of the observed atmospheric CO\(_2\) concentration at Mauna Loa, Hawai’i obtained with the function plot.acf()." width="672" />
<p class="caption">
Figure 3.11: Correlogram of the observed atmospheric CO<span class="math inline">\(_2\)</span> concentration at Mauna Loa, Hawai’i obtained with the function <code>plot.acf()</code>.
</p>
</div>
<p>Notice that all of the relevant information is still there (Figure <a href="sec-ts-correlation-within-and-among-time-series.html#fig:ts-plotbetterACF">3.11</a>), but now <span class="math inline">\(r_0=1\)</span> is not plotted at lag-0 and the lags on the <span class="math inline">\(x\)</span>-axis are displayed correctly as integers.</p>
<p>Before we move on to the PACF, let’s look at the ACF for some deterministic time series, which will help you identify interesting properties (<em>e.g.</em>, trends, seasonal effects) in a stochastic time series, and account for them in time series models–an important topic in this course. First, let’s look at a straight line.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## length of ts
nn &lt;-<span class="st"> </span><span class="dv">100</span>
## create straight line
tt &lt;-<span class="st"> </span><span class="kw">seq</span>(nn)
## set up plot area
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
## plot line
<span class="kw">plot.ts</span>(tt, <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">italic</span>(x[t])))
## get ACF
line.acf &lt;-<span class="st"> </span><span class="kw">acf</span>(tt, <span class="dt">plot =</span> <span class="ot">FALSE</span>)
## plot ACF
<span class="kw">plot.acf</span>(line.acf)</code></pre></div>
<p><img src="AFTS_files/figure-html/ts-LinearACF-1.png" width="672" /></p>

<div class="figure"><span id="fig:ts-plotLinearACF"></span>
<img src="AFTS_files/figure-html/ts-plotLinearACF-1.png" alt="Time series plot of a straight line (left) and the correlogram of its ACF (right)." width="672" />
<p class="caption">
Figure 3.12: Time series plot of a straight line (left) and the correlogram of its ACF (right).
</p>
</div>
<p>The correlogram for a straight line is itself a linearly decreasing function over time (Figure <a href="sec-ts-correlation-within-and-among-time-series.html#fig:ts-plotLinearACF">3.12</a>).</p>
<p>Now let’s examine the ACF for a sine wave and see what sort of pattern arises.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## create sine wave
tt &lt;-<span class="st"> </span><span class="kw">sin</span>(<span class="dv">2</span> *<span class="st"> </span>pi *<span class="st"> </span><span class="kw">seq</span>(nn)/<span class="dv">12</span>)
## set up plot area
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
## plot line
<span class="kw">plot.ts</span>(tt, <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">italic</span>(x[t])))
## get ACF
sine.acf &lt;-<span class="st"> </span><span class="kw">acf</span>(tt, <span class="dt">plot =</span> <span class="ot">FALSE</span>)
## plot ACF
<span class="kw">plot.acf</span>(sine.acf)</code></pre></div>

<div class="figure"><span id="fig:ts-plotSineACF"></span>
<img src="AFTS_files/figure-html/ts-plotSineACF-1.png" alt="Time series plot of a discrete sine wave (left) and the correlogram of its ACF (right)." width="672" />
<p class="caption">
Figure 3.13: Time series plot of a discrete sine wave (left) and the correlogram of its ACF (right).
</p>
</div>
<p>Perhaps not surprisingly, the correlogram for a sine wave is itself a sine wave whose amplitude decreases linearly over time (Figure <a href="sec-ts-correlation-within-and-among-time-series.html#fig:ts-plotSineACF">3.13</a>).</p>
<p>Now let’s examine the ACF for a sine wave with a linear downward trend and see what sort of patterns arise.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## create sine wave with trend
tt &lt;-<span class="st"> </span><span class="kw">sin</span>(<span class="dv">2</span> *<span class="st"> </span>pi *<span class="st"> </span><span class="kw">seq</span>(nn)/<span class="dv">12</span>) -<span class="st"> </span><span class="kw">seq</span>(nn)/<span class="dv">50</span>
## set up plot area
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
## plot line
<span class="kw">plot.ts</span>(tt, <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">italic</span>(x[t])))
## get ACF
sili.acf &lt;-<span class="st"> </span><span class="kw">acf</span>(tt, <span class="dt">plot =</span> <span class="ot">FALSE</span>)
## plot ACF
<span class="kw">plot.acf</span>(sili.acf)</code></pre></div>

<div class="figure"><span id="fig:ts-plotSiLiACF"></span>
<img src="AFTS_files/figure-html/ts-plotSiLiACF-1.png" alt="Time series plot of a discrete sine wave (left) and the correlogram of its ACF (right)." width="672" />
<p class="caption">
Figure 3.14: Time series plot of a discrete sine wave (left) and the correlogram of its ACF (right).
</p>
</div>
<p>The correlogram for a sine wave with a trend is itself a nonsymmetrical sine wave whose amplitude and center decrease over time (Figure <a href="sec-ts-correlation-within-and-among-time-series.html#fig:ts-plotSiLiACF">3.14</a>).</p>
<p>As we have seen, the ACF is a powerful tool in time series analysis for identifying important features in the data. As we will see later, the ACF is also an important diagnostic tool for helping to select the proper order of <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> in ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>) models.</p>
</div>
<div id="sec-ts-partial-autocorrelation-function-pacf" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Partial autocorrelation function (PACF)</h3>
<p>The partial autocorrelation function (PACF) measures the linear correlation of a series <span class="math inline">\(\{x_t\}\)</span> and a lagged version of itself <span class="math inline">\(\{x_{t+k}\}\)</span> with the linear dependence of <span class="math inline">\(\{x_{t-1},x_{t-2},\dots,x_{t-(k-1)}\}\)</span> removed. Recall from lecture that we define the PACF as</p>
<span class="math display" id="eq:PACFdefn">\[\begin{equation}
\tag{3.13}
f_k = \begin{cases}
        \text{Cor}(x_1,x_0)=r_1 &amp; \text{if } k = 1;\\
        \text{Cor}(x_k-x_k^{k-1},x_0-x_0^{k-1}) &amp; \text{if } k \geq 2;
      \end{cases}
\end{equation}\]</span>
<p>with</p>

<p>It’s easy to compute the PACF for a variable in R using the <code>pacf()</code> function, which will automatically plot a correlogram when called by itself (similar to <code>acf()</code>). Let’s look at the PACF for the CO<span class="math inline">\(_2\)</span> data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## PACF of the CO2 data
<span class="kw">pacf</span>(co2, <span class="dt">lag.max =</span> <span class="dv">36</span>)</code></pre></div>
<p>The default plot for PACF is a bit better than for ACF, but here is another plotting function that might be useful.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## better PACF plot
plot.pacf &lt;-<span class="st"> </span>function(PACFobj) {
    rr &lt;-<span class="st"> </span>PACFobj$acf
    kk &lt;-<span class="st"> </span><span class="kw">length</span>(rr)
    nn &lt;-<span class="st"> </span>PACFobj$n.used
    <span class="kw">plot</span>(<span class="kw">seq</span>(kk), rr, <span class="dt">type =</span> <span class="st">&quot;h&quot;</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">yaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="dt">xaxs =</span> <span class="st">&quot;i&quot;</span>, 
        <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">floor</span>(<span class="kw">min</span>(rr)), <span class="dv">1</span>), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, kk +<span class="st"> </span><span class="dv">1</span>), <span class="dt">xlab =</span> <span class="st">&quot;Lag&quot;</span>, 
        <span class="dt">ylab =</span> <span class="st">&quot;PACF&quot;</span>, <span class="dt">las =</span> <span class="dv">1</span>)
    <span class="kw">abline</span>(<span class="dt">h =</span> -<span class="dv">1</span>/nn +<span class="st"> </span><span class="kw">c</span>(-<span class="dv">2</span>, <span class="dv">2</span>)/<span class="kw">sqrt</span>(nn), <span class="dt">lty =</span> <span class="st">&quot;dashed&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)
    <span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>)
}</code></pre></div>

<div class="figure"><span id="fig:ts-plotPACFb"></span>
<img src="AFTS_files/figure-html/ts-plotPACFb-1.png" alt="Correlogram of the PACF for the observed atmospheric CO\(_2\) concentration at Mauna Loa, Hawai’i obtained with the function pacf()." width="672" />
<p class="caption">
Figure 3.15: Correlogram of the PACF for the observed atmospheric CO<span class="math inline">\(_2\)</span> concentration at Mauna Loa, Hawai’i obtained with the function <code>pacf()</code>.
</p>
</div>
<p>Notice in Figure <a href="sec-ts-correlation-within-and-among-time-series.html#fig:ts-plotPACFb">3.15</a> that the partial autocorrelation at lag-1 is very high (it equals the ACF at lag-1), but the other values at lags &gt; 1 are relatively small, unlike what we saw for the ACF. We will discuss this in more detail later on in this lab.</p>
<p>Notice also that the PACF plot again has real-valued indices for the time lag, but it does not include any value for lag-0 because it is impossible to remove any intermediate autocorrelation between <span class="math inline">\(t\)</span> and <span class="math inline">\(t-k\)</span> when <span class="math inline">\(k=0\)</span>, and therefore the PACF does not exist at lag-0. If you would like, you can use the <code>plot.acf()</code> function we defined above to plot the PACF estimates because <code>acf()</code> and <code>pacf()</code> produce identical list structures (results not shown here).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## PACF of the CO2 data
co2.pacf &lt;-<span class="st"> </span><span class="kw">pacf</span>(co2)
## correlogram of the CO2 data
<span class="kw">plot.acf</span>(co2.pacf)</code></pre></div>
<p>As with the ACF, we will see later on how the PACF can also be used to help identify the appropriate order of <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> in ARMA(<span class="math inline">\(p\)</span>,<span class="math inline">\(q\)</span>) models.</p>
</div>
<div id="sec-ts-cross-correlation-function-ccf" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Cross-correlation function (CCF)</h3>
<p>Often we are interested in looking for relationships between 2 different time series. There are many ways to do this, but a simple method is via examination of their cross-covariance and cross-correlation.</p>
<p>We begin by defining the sample cross-covariance function (CCVF) in a manner similar to the ACVF, in that</p>
<span class="math display" id="eq:CCVF">\[\begin{equation}
\tag{3.14}
g_k^{xy} = \frac{1}{n}\sum_{t=1}^{n-k} \left(y_t-\bar{y}\right) \left(x_{t+k}-\bar{x}\right),
\end{equation}\]</span>
<p>but now we are estimating the correlation between a variable <span class="math inline">\(y\)</span> and a <em>different</em> time-shifted variable <span class="math inline">\(x_{t+k}\)</span>. The sample cross-correlation function (CCF) is then defined analogously to the ACF, such that</p>
<span class="math display" id="eq:CCF">\[\begin{equation}
\tag{3.15}
r_k^{xy} = \frac{g_k^{xy}}{\sqrt{\text{SD}_x\text{SD}_y}};
\end{equation}\]</span>
<p>SD<span class="math inline">\(_x\)</span> and SD<span class="math inline">\(_y\)</span> are the sample standard deviations of <span class="math inline">\(\{x_t\}\)</span> and <span class="math inline">\(\{y_t\}\)</span>, respectively. It is important to re-iterate here that <span class="math inline">\(r_k^{xy} \neq r_{-k}^{xy}\)</span>, but <span class="math inline">\(r_k^{xy} = r_{-k}^{yx}\)</span>. Therefore, it is very important to pay particular attention to which variable you call <span class="math inline">\(y\)</span> (<em>i.e.</em>, the “response”) and which you call <span class="math inline">\(x\)</span> (<em>i.e.</em>, the “predictor”).</p>
<p>As with the ACF, an approximate 95% confidence interval on the CCF can be estimated by</p>
<span class="math display" id="eq:CCF95CI">\[\begin{equation}
\tag{3.16}
-\frac{1}{n} \pm \frac{2}{\sqrt{n}}
\end{equation}\]</span>
<p>where <span class="math inline">\(n\)</span> is the number of data points used in the calculation of the CCF, and the same assumptions apply to its interpretation.</p>
<p>Computing the CCF in R is easy with the function <code>ccf()</code> and it works just like <code>acf()</code>. In fact, <code>ccf()</code> is just a “wrapper” function that calls <code>acf()</code>. As an example, let’s examine the CCF between sunspot activity and number of lynx trapped in Canada as in the classic paper by Moran.</p>
<p>To begin, let’s get the data, which are conveniently included in the <strong>datasets</strong> package included as part of the base installation of R. Before calculating the CCF, however, we need to find the matching years of data. Again, we’ll use the <code>ts.intersect()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## get the matching years of sunspot data
suns &lt;-<span class="st"> </span><span class="kw">ts.intersect</span>(lynx, sunspot.year)[, <span class="st">&quot;sunspot.year&quot;</span>]
## get the matching lynx data
lynx &lt;-<span class="st"> </span><span class="kw">ts.intersect</span>(lynx, sunspot.year)[, <span class="st">&quot;lynx&quot;</span>]</code></pre></div>
<p>Here are plots of the time series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## plot time series
<span class="kw">plot</span>(<span class="kw">cbind</span>(suns, lynx), <span class="dt">yax.flip =</span> <span class="ot">TRUE</span>)</code></pre></div>

<div class="figure"><span id="fig:ts-plotSunsLynx"></span>
<img src="AFTS_files/figure-html/ts-plotSunsLynx-1.png" alt="Time series of sunspot activity (top) and lynx trappings in Canada (bottom) from 1821-1934." width="672" />
<p class="caption">
Figure 3.16: Time series of sunspot activity (top) and lynx trappings in Canada (bottom) from 1821-1934.
</p>
</div>
<p>It is important to remember which of the 2 variables you call <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> when calling <code>ccf(x, y, ...)</code>. In this case, it seems most relevant to treat lynx as the <span class="math inline">\(y\)</span> and sunspots as the <span class="math inline">\(x\)</span>, in which case we are mostly interested in the CCF at negative lags (<em>i.e.</em>, when sunspot activity predates inferred lynx abundance). Furthermore, we’ll use log-transformed lynx trappings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## CCF of sunspots and lynx
<span class="kw">ccf</span>(suns, <span class="kw">log</span>(lynx), <span class="dt">ylab =</span> <span class="st">&quot;Cross-correlation&quot;</span>)</code></pre></div>

<div class="figure"><span id="fig:ts-plotCCFb"></span>
<img src="AFTS_files/figure-html/ts-plotCCFb-1.png" alt="CCF for annual sunspot activity and the log of the number of lynx trappings in Canada from 1821-1934." width="672" />
<p class="caption">
Figure 3.17: CCF for annual sunspot activity and the log of the number of lynx trappings in Canada from 1821-1934.
</p>
</div>
<p>From Figures <a href="sec-ts-correlation-within-and-among-time-series.html#fig:ts-plotSunsLynx">3.16</a> and <a href="sec-ts-correlation-within-and-among-time-series.html#fig:ts-plotCCFb">3.17</a> it looks like lynx numbers are relatively low 3-5 years after high sunspot activity (<em>i.e.</em>, significant correlation at lags of -3 to -5).</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sec-ts-differencing-to-remove-a-trend-or-seasonal-effects.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sec-ts-white-noise-wn.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/nwfsc-timeseries/AFTSLabbook/edit/master/cleanedRmd/intro-ts-funcs.Rmd",
"text": "Edit"
},
"download": ["AFTS.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
